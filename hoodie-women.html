<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>هودی سه‌بعدی با Three.js</title>
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background-color: #f3f1e0;
      color: #3e2723;
      text-align: center;
      padding: 20px;
      direction: rtl;
    }
    #canvasContainer {
      width: 100%;
      height: 500px;
      margin: 0 auto;
    }
    .color-picker {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }
    .color-circle {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 2px solid #ccc;
      cursor: pointer;
    }
    .color-circle.selected {
      border: 3px solid #000;
    }
    input, button {
      padding: 10px;
      margin: 10px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #795548;
      color: white;
      border: none;
    }
  </style>
</head>
<body>
  <h1>هودی زنانه با Three.js</h1>
  <p>مدل را مشاهده، رنگ را انتخاب و متن را روی آن قرار دهید:</p>

  <div id="canvasContainer"></div>

  <div class="color-picker">
    <div class="color-circle" data-color="#ff0000" style="background-color: red;"></div>
    <div class="color-circle" data-color="#0000ff" style="background-color: blue;"></div>
    <div class="color-circle" data-color="#000000" style="background-color: black;"></div>
    <div class="color-circle" data-color="#ffffff" style="background-color: white; border: 1px solid #aaa;"></div>
  </div>

  <input type="text" id="textInput" placeholder="مثلاً توسکا" />
  <button id="applyText">اعمال متن</button>

  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js';
    import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.161.0/examples/jsm/loaders/GLTFLoader.js';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.161.0/examples/jsm/controls/OrbitControls.js';

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / 500, 0.1, 1000);
    camera.position.set(0, 1.5, 3);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, 500);
    document.getElementById("canvasContainer").appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1.5);
    scene.add(light);

    let hoodie;
    const loader = new GLTFLoader();
    loader.load('hoodie.glb', (gltf) => {
      hoodie = gltf.scene;
      hoodie.scale.set(1.5, 1.5, 1.5);
      scene.add(hoodie);
    });

    // متن دوبعدی به صورت Plane
    let textMesh = null;
    function updateText(text) {
      if (textMesh) scene.remove(textMesh);

      const canvas = document.createElement("canvas");
      canvas.width = 512;
      canvas.height = 256;
      const ctx = canvas.getContext("2d");
      ctx.fillStyle = "white";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "black";
      ctx.font = "40px Vazirmatn";
      ctx.textAlign = "center";
      ctx.fillText(text, canvas.width / 2, canvas.height / 2 + 15);

      const texture = new THREE.CanvasTexture(canvas);
      const material = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
      const geometry = new THREE.PlaneGeometry(1, 0.5);
      textMesh = new THREE.Mesh(geometry, material);
      textMesh.position.set(0, 1.3, 0.7); // جلوی لباس
      scene.add(textMesh);
    }

    // رنگ
    function changeColor(hex) {
      if (hoodie) {
        hoodie.traverse(child => {
          if (child.isMesh) {
            child.material.color.set(hex);
          }
        });
      }
    }

    // تعاملات
    document.querySelectorAll(".color-circle").forEach(circle => {
      circle.addEventListener("click", () => {
        document.querySelectorAll(".color-circle").forEach(c => c.classList.remove("selected"));
        circle.classList.add("selected");
        const hex = circle.getAttribute("data-color");
        changeColor(hex);
      });
    });

    document.getElementById("applyText").addEventListener("click", () => {
      const text = document.getElementById("textInput").value.trim();
      if (text) updateText(text);
    });

    // رندر
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
