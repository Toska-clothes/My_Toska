<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>هودی زنانه | نمایش سه‌بعدی</title>
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background-color: #f3f1e0;
      color: #3e2723;
      text-align: center;
      padding: 20px;
    }
    canvas {
      display: block;
      margin: 0 auto;
    }
    .controls {
      margin-top: 20px;
    }
    .color-circle {
      display: inline-block;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      margin: 0 5px;
      cursor: pointer;
      border: 2px solid #ccc;
    }
    .selected {
      border: 3px solid black;
    }
    input, button {
      padding: 10px;
      margin: 10px;
      border-radius: 5px;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <h1>هودی زنانه</h1>
  <p>رنگ و متن را انتخاب کنید:</p>

  <div class="controls">
    <div>
      <div class="color-circle" style="background:red;" data-color="#ff0000"></div>
      <div class="color-circle" style="background:blue;" data-color="#0000ff"></div>
      <div class="color-circle" style="background:black;" data-color="#000000"></div>
      <div class="color-circle" style="background:white; border:1px solid #aaa;" data-color="#ffffff"></div>
    </div>
    <input type="text" id="textInput" placeholder="مثلاً توسکا"/>
    <button onclick="updateTexture()">اعمال متن</button>
  </div>

  <div id="viewer"></div>

  <script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three';
    import { GLTFLoader } from 'https://cdn.skypack.dev/three/examples/jsm/loaders/GLTFLoader.js';
    import { OrbitControls } from 'https://cdn.skypack.dev/three/examples/jsm/controls/OrbitControls.js';

    let scene, camera, renderer, controls, hoodieMesh, baseMaterial;
    const canvasTex = new THREE.CanvasTexture(createTextCanvas(''));
    canvasTex.flipY = false;

    init();
    loadModel();

    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color('#f3f1e0');

      camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
      camera.position.set(0, 1.5, 3);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth * 0.9, window.innerHeight * 0.6);
      document.getElementById('viewer').appendChild(renderer.domElement);

      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1.2);
      scene.add(light);

      animate();
    }

    function loadModel() {
      const loader = new GLTFLoader();
      loader.load(
        'hoodie.glb', // مسیر فایل GLB
        gltf => {
          console.log("مدل GLB با موفقیت بارگذاری شد");
          hoodieMesh = gltf.scene;
          hoodieMesh.traverse(child => {
            if (child.isMesh) {
              child.material = new THREE.MeshStandardMaterial({ map: canvasTex });
            }
          });
          scene.add(hoodieMesh);
        },
        undefined, // برای پیشرفت بارگذاری
        error => {
          console.error("خطا در بارگذاری مدل:", error);
        }
      );
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    function createTextCanvas(text) {
      const canvas = document.createElement('canvas');
      canvas.width = 512;
      canvas.height = 512;
      const ctx = canvas.getContext('2d');

      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = '#000000';
      ctx.font = 'bold 40px Vazirmatn';
      ctx.textAlign = 'center';
      ctx.fillText(text, canvas.width / 2, canvas.height / 2);

      return canvas;
    }

    function updateTexture() {
      const text = document.getElementById('textInput').value || '';
      const newCanvas = createTextCanvas(text);
      canvasTex.image = newCanvas;
      canvasTex.needsUpdate = true;
    }

    document.querySelectorAll('.color-circle').forEach(circle => {
      circle.addEventListener('click', () => {
        document.querySelectorAll('.color-circle').forEach(c => c.classList.remove('selected'));
        circle.classList.add('selected');
        const color = circle.getAttribute('data-color');
        if (hoodieMesh) {
          hoodieMesh.traverse(child => {
            if (child.isMesh) {
              child.material.color.set(color);
            }
          });
        }
      });
    });
  </script>
</body>
</html>
